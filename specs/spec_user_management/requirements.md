# 用户管理功能需求

## 背景
批改与错题管理平台需要开放给多位教师进行试用。为了避免测试数据互相干扰并保障账号安全，必须提供完整的用户注册、登录、会话维护以及数据隔离能力。本需求文档用于描述该能力的用户故事与验收标准，并作为前后端实现与测试的依据。

## 需求列表

### 需求 1：教师账号注册与登录
**用户故事**：作为一名老师，我希望可以在前端自行注册账号并登录系统，从而独立体验批改与错题管理功能。

**验收标准**
1. 教师提交合法的注册信息（姓名、邮箱、密码、是否复制 Demo 数据）时，系统创建账号并返回成功提示。
2. 教师使用注册邮箱与密码登录时，系统签发 JWT 并返回给前端保存。
3. 登录失败（错误邮箱或密码）时，系统返回明确的错误信息。
4. 注册时可选「复制 Demo 数据」，勾选后会复制一份与该账号绑定的示例数据。

### 需求 2：会话管理与安全退出
**用户故事**：作为一名老师，我需要能够随时退出登录，并确保长时间未操作的会话自动失效，以保护我的账号。

**验收标准**
1. 教师点击前端的「退出登录」按钮后，系统立即删除本地 token，并返回登录页。
2. 后端签发的 JWT 包含过期时间。token 过期或验证失败时，接口返回 401；前端收到后触发全局注销。
3. 前端需要在本地缓存 token，并在所有需要鉴权的请求中自动附加 `Authorization: Bearer <token>` 头。

### 需求 3：数据隔离
**用户故事**：作为一名老师，我希望仅能访问自己创建的班级、学生、试卷等资源，防止不同老师的测试数据相互影响。

**验收标准**
1. 后端所有受保护资源在查询、写入时必须基于 `owner_id` 过滤，只返回当前登录教师的数据。
2. 当教师尝试访问不属于自己的资源时，接口返回 404 或 403。
3. 前端在登录后展示的列表、面板等数据均来自当前用户的访问令牌，页面加载时调用的接口必须经过鉴权。

### 需求 4：Demo 数据复制
**用户故事**：作为首次体验的老师，我希望注册时可以一键复制示例数据进行快速体验，同时不影响其他老师的数据。

**验收标准**
1. 注册接口在 `create_demo_data=true` 时为新用户复制一份 Demo 数据，数据的 `owner_id` 填写为该用户。
2. 前端注册表单提供「初始化示例数据」开关，并在成功注册后自动登录并跳转到仪表盘。

### 需求 5：前端认证体验
**用户故事**：作为使用者，我希望前端界面提供登录、注册、退出等基础体验，且交互友好。

**验收标准**
1. 未登录访问任意受保护路由时，前端重定向到认证页面 `AuthPage`。
2. 认证页面包含登录与注册两个 Tab，具备基础表单校验（邮箱、密码长度、确认密码一致等）。
3. 登录成功后自动跳转回原目标路由；注册成功后自动登录并跳转仪表盘。
4. 页眉显示当前登录教师名称，并提供明确的退出入口。

### 需求 6：测试与回归
**用户故事**：作为项目维护者，我希望有自动化测试与手动验证指引，以便快速回归和验证隔离行为。

**验收标准**
1. 后端新增 pytest 覆盖注册/登录流程、重复注册失败、跨用户资源隔离等场景。
2. 前端使用 Vitest + Testing Library 验证 `AuthContext` 的登录、刷新、注销行为。
3. 提供基础的手动检验步骤：注册两个账号、切换登录确认数据隔离、验证 token 失效后的自动退出行为。
