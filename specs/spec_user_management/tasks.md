# 实施计划

按优先级拆分为七个任务，每个任务的完成状态及交付物如下。

- [x] **任务 1：设计与数据库迁移**  
  - 交付物：`User` 模型、核心表 `owner_id` 字段、设计文档更新。  
  - 需求关联：#1、#3、#4。  
  - 说明：数据库结构已调整，原有业务数据均带上 `owner_id`。

- [x] **任务 2：后端认证接口**  
  - 交付物：`POST /auth/register`、`POST /auth/token`、`GET /auth/me`，密码哈希与 JWT 生成逻辑，`get_current_user` 依赖。  
  - 需求关联：#1、#2、#3、#4。  
  - 说明：认证流程可签发带过期时间的 Bearer Token，401 时返回统一错误信息。

- [x] **任务 3：Demo 数据复制**  
  - 交付物：注册开关 `create_demo_data`、`create_demo_dataset_for_user` 实现及示例数据复制。  
  - 需求关联：#4。  
  - 说明：复制的数据均绑定新用户的 `owner_id`，互不干扰。

- [x] **任务 4：资源访问控制**  
  - 交付物：所有受保护路由接入 `get_current_user` 并按 `owner_id` 过滤读写。  
  - 需求关联：#3。  
  - 说明：跨账号访问返回 404/403，确保数据隔离。

- [x] **任务 5：前端认证流程**  
  - 交付物：`AuthContext`、`AuthPage` 登录/注册页、token 存储与请求拦截器。  
  - 需求关联：#1、#2、#5。  
  - 说明：未登录访问受保护路由时自动跳转认证页，注册成功后自动登录。

- [x] **任务 6：前端状态与隔离验证**  
  - 交付物：仪表盘及业务页面基于当前用户加载数据、全局 401 登出、页眉用户信息和退出按钮。  
  - 需求关联：#2、#3、#5。  
  - 说明：`AppGate` 控制入口，401 事件触发全局注销。

- [x] **任务 7：测试与验证**  
  - 交付物：`backend/tests/test_auth.py`、`frontend/src/context/AuthContext.test.tsx`、手动验证用例。  
  - 需求关联：#1、#2、#3、#4、#5、#6。  
  - 说明：后端覆盖注册/登录/隔离、前端覆盖上下文行为；遗留测试待补充鉴权凭据。
